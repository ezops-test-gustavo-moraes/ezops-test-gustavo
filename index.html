<!DOCTYPE html>
<html>
    <head>
        <title>EzOps Test Gustavo</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
        <script src="/socket.io/socket.io.js"></script>
    </head>
    <body style="background-color: theme;" #theme>
        <div class="container" style="width: 60%;float:left;">
            <br>
            <div class="jumbotron">
                <h1 class="display-4">Faça uma Pergunta</h1>
                <br>
                <input id = "name" class="form-control" placeholder="Seu Nome">
                <br>
                <input id = "message" class="form-control" placeholder="Sua Pergunta Aqui">
                <br>
                <button id="send" style="float:right;" class="btn btn-success">Mandar</button>
                <button class="btn btn-danger" onClick="deleteMessage()">Apagar as mais frequentes</button>
            </div>
        </div>
        <div style="float:right;width: 40%;">
            <h2 style="text-align: center;">Perguntas mais frequentes:</h2>
            <br>
            <div id="del">
                <div id="messages"></div>
            </div>
        </div>
        <script>
            var socket = io();
            $(() => {
                $("#send").click(()=>{
                    sendMessage({name: $("#name").val(), message: $("#message").val()});
                })
                getMessages()
            })

            socket.on('message', addMessages)

            function addMessages(message){
                var aks =
                        `
                            <div id="del" style="box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);padding: 2px 16px;">
                                <p style="color: green;">${message.message}</p>
                                <small>escrita por ${message.name}</small>
                            </div>
                            <br>
                        `
                $("#messages").append(aks)
            }

            function getMessages(){
                $.get('http://'+ location.hostname +':3000/messages', (data) => {
                    alert("Seja Bem Vindo!");
                    data.forEach(addMessages);
                })
            }

            function sendMessage(message){
                if (message.name && message.message) {
                    if ((message.message === 'Oi') || "Tudo bem?" || "Que horas são?" || "Que dia é hoje?" || "Quanto vale o dólar em real?") {
                        switch(message.message) {
                        case "Oi":
                            alert("Olá, como posso te ajudar " + message.name + "?")
                            break;
                        case "Tudo bem?":
                            alert("Comigo está tudo bem, e com você?")
                            break;
                        case "Que horas são?":
                            var data = new Date();
                            alert("São exatamente" + data.getHours() + ":" + data.getMinutes() + " " + message.name);
                            break;
                        case "Que dia é hoje?":
                            var data = new Date();
                            alert("Hoje é dia " + data.getDay() + "/" + data.getMonth() + "/" + data.getFullYear() + " " + message.name);
                            break;
                        case "Quanto vale o dólar em real?":
                            $.get('https://economia.awesomeapi.com.br/json/last/USD-BRL', (data) => {
                                alert("O valor atual do dólar é de " + data.USDBRL.ask + " reais " + message.name);
                            })
                            break;
                        case "Quanto vale o euro em real?":
                            $.get('https://economia.awesomeapi.com.br/json/last/EUR-BRL', (data) => {
                                alert("O valor atual do euro é de " + data.EURBRL.ask + " reais " + message.name);
                            })
                            break;
                        }
                    } else {
                        alert("Desculpa " + message.name + ", não consigo responder essa.")
                        $.post('http://'+ location.hostname +':3000/messages', message)
                    }
                } else {
                    alert("Gostaria de alguma ajuda?");
                }

            }

            function deleteMessage(){
                alert("Deseja apagar as mais frequentes?");
                document.getElementById('del').style.display = 'none'
            }

        </script>
    </body>
</html>